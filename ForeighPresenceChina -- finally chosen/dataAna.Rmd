---
title: "Foreign Presence & ETCs"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r library we need}
library(ggplot2)
library(scales)
```

## 1. Exploring the Dataset
```{r}
load("./ForeighPresenceChina -- finally chosen/ForeignPresence&ETCs.RData")
mnc <- as.data.frame(x)
str(mnc)
View(summary(mnc))
mode(mnc[,"province"])
```
### 1.1. Description

The dataset contains 40 variables and 11360 observations. The data covered 11360 different companies observed across 30 provinces in China out of a total of 276,474 companies recorded in 2004 by National Bureau of Statistics of China (2014). The variables are divided into three groups, i.e. firm-level variables, industry-level variables and province-level variables. Firm-level variables consist of the properties of each firm, which include the type of ownership, revenue, number of employees and several variables that highlight the relationship between a firm and the government of China in 2004. Industry-level variables illustrate the scale of the industry and the market share of different groups of companies, including foreign firms and the industry leaders. Also, They also try highlight the amount of govenrment influence by measuring the linear combination of the amount of help received by government officials as well as the median of tax rate incurred by each firm in the industry. Lastly, province-level variables indicate the macroeconomic information regarding a province, such as its GDP per capita and the level of MNC activities in the region (e.g. foreign direct investments and trades). Below are the details of each variable analysed in this report.


#### Firm-Level Variables
|Variable|Description|
|:------------|:------------------------------------------------|
|`idstd`|Company ID|
|`lectcs`|Log of firm expenditures on entertainment as a percentage of annual revenue.|
|`soe`|Whether a firm is state-owned or not. (1 = Yes, 0 = No)|
|`collective`|Whether a firm is collectively-owned. (1 = Yes, 0 = No)|
|`private`|Whether a firm is privately-owned. (1 = Yes, 0 = No)|
|`foreign_HMT`|Whether a firm is owned by foreign owner from Hong Kong, Macao or Taiwan.|
|`foreign_NonHMT`|Whether a firm is owned by foreign owner other not from Hong Kong, Macao or Taiwan.|
|`mixedown`|Other firms not identified in `soe`, `collective`, `private`, `foreign_HMT` and `foreign_NonHMT` are coded 1.|
|`revenue`|Total revenue in 2004 in log form|
|`lemp`|Total number of employee in 2004 in log form|
|`sales_otherprov`|Whether a firm sells to other provinces. (1 = Yes, 0 = No)|
|`govtsales`|Proportion of revenue from transactions with the government|
|`soesales`|Proportion of revenue from transactions with state-owned enterprises|
|`relationship`|Years of relationships between the firm and its main clients|
|`licenses`|Number of licenses required to operate|
|`lceopay`|CEO annual salary in log form|
|`interaction`|Number of days of interactions with the government|
|`gm_govt`|Whether the general manager is appointed by the government. (1 = Yes, 0 = No)|


#### Industry-Level Variables
|Variable|Description|
|:------------|:------------------------------------------------|
|`foreign_output`|The share of output by foreign-owned firms|
|`HMT_output`|Percentage output by firms owned by shareholders from Hong Kong, Macao or Taiwan|
|`NonHMT_output`|Percentage output by firms owned by other foreign nationals|
|`w_con_pdc4`|Market share of four biggest firms in the industry|
|`w_con_pdc8`|Market share of eight biggest firms in the industry|
|`marketsize`|The market size of the industry|
|`growthrate`|Output growth 2001-2003|
|`last_intensity`|the ratio of fixed asset per number of employees in log form|
|`lscale`|The mean of the size of firms that has 50% of industry market share in log form|
|`mgovthelp`|A linear combination of government helpfullness based on the contribution of government officials|
|`mtaxrate`|Median of firms tax paid divided by total revenue|
|`prov_ind`|Industry ID by Province|

#### Province-Level Variables
|Variable|Description|
|:--------------|:------------------------------------------------|
|`MNC`|Principal factor analysis of FDI inflow and MNC trades in a province|
|`lwdist`|Geographic distance|
|`lgdpper2003`|Log of GDP per capita of the province in 2003|
|`gdp2003`|GDP in 2003|
|`lpop2003`|Log of the province's population in 2003|
|`province`|The name of the province|
|`provinceID`|Province ID|


**I'm trying to explain the stregth and limitations here**

This dataset represent the ties between firms and the government of China. Given the unique feature of Chinese industry that most of big firms in China are state-owned, as of 98 companies in 2014 Fortune 500, 76 of them are state-owned (Cendrowski, 2015), this dataset would highlight how strong the relationship with the goverment affect the CEO salary of a company or the company revenue. 

However, the dataset possess some limitations. Although industry ID numbers are provided, the sector was not clearly specified in the dataset or in previous publications. Moreover, the same industry in different provinces were coded differently, thus, the impact of a specific industry could not be measured. 




## 2. Statistics description of the dataset 
### 2.1 About the province
#### 2.1.1 Explore the provinces
```{r}
summary(as.factor(mnc[,"province"]))

# plot the numbers of sample of different provinces
ggplot(mnc) + geom_bar(aes(x = as.factor(province)))+ theme(axis.text.x = element_text(angle = 45,colour = "black",size=13,hjust=1))

#get the data for province
mnc.prov <- as.data.frame(mnc[!duplicated(x[,"province"]),])

#plot the GDP of different provinces
ggplot(mnc.prov) + geom_bar(aes(x = as.factor(province), y = gdp2003),stat = "identity", position = "dodge") + theme(axis.text.x = element_text(angle = 45,colour = "black",size=13,hjust=1))

```

From the barchart, we can know that The first highest three GDP provinces are Guangdong, Jiangsu and Shandong. The last three GDP provinces are Qinghai, Ningxia and Hainan.

### 2.1.2 Describe the relationship between the total population and capital GDP for different provinces.
```{r}
ggplot(mnc.prov) + geom_line(aes(x = lpop2003, y = lgdpper2003))
cor.test(mnc.prov[,"lpop2003"], mnc.prov[,"lgdpper2003"])

```

So we can get that there is no strong relationship between the population and capital. From the correlation test result, we found that the p value is 0.4043, which is much larger than 0.05, so we can not reject the Null Hypothesis at a 95% confindence level. There is no strong correlation between these two variables.

### 2.1.3 Describe the relationship between the weighted geographic distance and capital GDP for different provinces.
```{r}
ggplot(mnc.prov) + geom_point(aes(x = lwdist, y = lgdpper2003))
cor.test(mnc.prov[,"lwdist"], mnc.prov[,"lgdpper2003"])

```

So we can get that there is no strong relationship between the weighted geographic distance and capital GDP. From the correlation test result, we found that the p value is 0.3297, which is much larger than 0.05, so we can not reject the Null Hypothesis at a 95% confindence level. There is no strong correlation between these two variables. But these two variables are positive correlated, which means the larger the weighted geographic distance, the more capital GDP of the province.

### 2.1.4 The variance of captal GDP and total GDP of differene provinces. 
```{r}
var.test(data.prov[,"gdp2003"], data.prov[,"lgdpper2003"],alternative = "two.sided")

```
We can conclude that  the p value is 0.04, which is smaller than 0.05, so we can reject the None Hypothesis, and accept the alternative hypothesis: the variance of capital gdp and total gdp is not identital.

### 2.1.5 what kind of province-level variables influence province's total GDP?

```{r}
pairs(gdp2003 ~ lgdpper2003 + lwdist + lpop2003 + MNC, data = data.prov)
#linear regression 
lm_gdp2003 <- lm(gdp2003 ~ lgdpper2003 + lwdist + lpop2003 , data = data.prov)
summary(lm_gdp2003)
```

We can find out that the Adjusted R-squared is 0.7781, and we got the linear regression model function that:
$$gdp2003 = -4.87 + 0.38*lgdpper2003 + 0.22*lwdist + 0.29*lpop2003 $$


### 2.1.5 Description of the firms ownership 
```{r}
mnc[,"ownership"] <- NA
for (j in 1:nrow(mnc)){
  if (mnc[j,"soe"] == 1) mnc[j,"ownership"] <- "state"
  if (mnc[j,"collective"] == 1) mnc[j,"ownership"] <- "collective"
  if (mnc[j,"private"] == 1) mnc[j,"ownership"] <- "private"
  if (mnc[j,"foreign_HMT"] == 1) mnc[j,"ownership"] <- "foreign_HMT"
  if (mnc[j,"foreign_NonHMT"] == 1) mnc[j,"ownership"] <- "foreign_NonHMT"
  if (mnc[j,"mixedown"] == 1) mnc[j,"ownership"] <- "mixed"
}

count(mnc[,"ownership"])

ggplot(data=mnc) + geom_bar(aes(ownership))

#Average revenue of each ownership
mean(mnc[mnc[,"ownership"]=="state", "revenue"])
mean(mnc[mnc[,"ownership"]=="collective", "revenue"])
mean(mnc[mnc[,"ownership"]=="private", "revenue"])
mean(mnc[mnc[,"ownership"]=="foreign_HMT", "revenue"])
mean(mnc[mnc[,"ownership"]=="foreign_NonHMT", "revenue"])

ggplot(data=mnc) + geom_boxplot(aes(ownership, revenue))

```

As we can see of the barplot there is a lot of companies in the bar with "mixed" ownership compared to the other categories. Therefore it might be difficult to do any valuable analysis on this data. If we look at the boxplot we can see that it looks like the distribution of revenue might be different between the different kind of ownership. To investigate this further we need a t-test.

# 3. Correlation Analysis

## Correlation test among different variables with "revenue (log of total business income)"
According to the dataset provided, we would like to examine the correlation of market size, output growth rate, help from government and GDP with the total business income.
```{r}
cor.test(mnc[, "revenue"], mnc[, "mgovthelp"])
cor.test(mnc[, "revenue"], mnc[, "marketsize"])
cor.test(mnc[, "revenue"], mnc[, "growthrate"])
cor.test(mnc[, "revenue"], mnc[, "gdp2003"])


```
cor.test(mnc[, "revenue"], mnc[, "govtsales"])
cor.test(mnc[, "revenue"], mnc[, "relationship"])
cor.test(mnc[, "revenue"], mnc[, "licenses"])
cor.test(mnc[, "revenue"], mnc[, "lceopay"])
cor.test(mnc[, "revenue"], mnc[, "interaction"])


```

Based on the correlation test, it could be observed that the total business income of one company has a relative strong positive correlation with both the market size and GDP. However, its correlation with government help (positive) and growth rate (negative) is very weak.

# 4. Linear Regression
## Single Variable Linear Regression Test with "revenue" as the dependent variable

```{r}
rev_rel <- lm(revenue ~ relationship, data = mnc)
summary(rev_rel)

rev_rel <- lm(revenue ~ marketsize, data = mnc)
summary(rev_rel)

rev_rel <- lm(revenue ~ lceopay, data = mnc)
summary(rev_rel)

rev_rel <- lm(revenue ~ gdp2003, data = mnc)
summary(rev_rel)
```

## Multiple Linear Regression Test with revenue as the dependent variable

As a result of our correlation analysis we would like to look further into the revenue variable by adding relationship, marketsize, CEO pay and GDP 2003 as independent variables. 

```{r}
rev_reg <- lm(revenue ~ relationship + marketsize + lceopay + gdp2003, data = mnc)
summary(rev_reg)
```
 
From the regression model we get an adjusted R-squared equal to 0.316, which means that 31.6 % of the revenue variable is described in this model. All the dependent variables are significant at the 1% level.

The intercept tells us what the log of revenue (???) will be if all our independent variables are zero. This number is negative and does not give us any valuable information without combining it with more variables. If we look at the relationship variable we can see that by increasing the number of relationships by one, revenue will increase by 13.6 %.  The estimate of marketsize tells us that 1% change in marketsize will result in 0.33% change in revenue.

By looking at the lceopay we can see that 1% change in the CEO pay wil result in 0.76% change in revenue. The GDP 2003    


Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
